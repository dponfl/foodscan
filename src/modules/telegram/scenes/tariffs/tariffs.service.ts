import { Injectable, Logger } from '@nestjs/common';
import { IScene, MyContext } from '../../../../types';
import { CALLBACK_DATA, SCENES, WAITING_FOR_INPUT } from '../scenes.constants';
import { InlineKeyboard } from 'grammy';

@Injectable()
export class TariffsSceneService implements IScene {
  private readonly logger = new Logger(TariffsSceneService.name);

  readonly SCENE_NAME = SCENES.TARIFFS;

  async handle(ctx: MyContext): Promise<void> {
    ctx.session.waitingForInput = null;
    ctx.session.sceneEntryTime = Date.now();
    ctx.session.currentScene = this.SCENE_NAME;

    const text = `üí° <b>–ó–¥–æ—Ä–æ–≤—å–µ ‚Äî —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</b>.

–° E-scanner —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å:

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–∞–≤–∞ <b>–ª—é–±–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞</b> ¬†
‚ö†Ô∏è –í—ã—è–≤–ª–µ–Ω–∏–µ <b>–≤—Ä–µ–¥–Ω—ã—Ö –¥–æ–±–∞–≤–æ–∫ –∏ –ï-—à–µ–∫</b> ¬†
ü•ó –°–æ–≤–µ—Ç—ã: —á—Ç–æ <b>–ù–ï –µ—Å—Ç—å</b>, —á–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –∏ <b>–∫–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º</b> ¬†
üì∑ –í—Å—ë –ø—Ä–æ—Å—Ç–æ: <b>—Å—Ñ–æ—Ç–∫–∞–ª ‚Äî –ø–æ–ª—É—á–∏–ª —á–µ—Å—Ç–Ω—ã–π —Ä–∞–∑–±–æ—Ä</b>

---

üéÅ <b>–ü—Ä–æ–±–Ω–∞—è –≤–µ—Ä—Å–∏—è</b>:
–¢—ã –ø–æ–ª—É—á–∞–µ—à—å <b>3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</b>, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑—É —Å–µ—Ä–≤–∏—Å–∞.

---

üí≥ –î–∞–ª—å—à–µ:

‚Ä¢ 1 –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî <b>39 ‚ÇΩ</b> (23 ‚≠êÔ∏è)
‚Ä¢ 10 –ø—Ä–æ–≤–µ—Ä–æ–∫ ‚Äî <b>299 ‚ÇΩ</b> (175 ‚≠êÔ∏è)
‚Ä¢ –ü–æ–¥–ø–∏—Å–∫–∞ (–±–µ–∑–ª–∏–º–∏—Ç) ‚Äî <b>549 ‚ÇΩ –≤ –º–µ—Å—è—Ü</b> (323 ‚≠êÔ∏è) –∏–ª–∏ <b>3 490 ‚ÇΩ –≤ –≥–æ–¥</b> (2 053 ‚≠êÔ∏è)

---

üôå <b>–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –æ–ø–ª–∞—Ç–∏—Ç—å?</b>

‚Äì –¢—ã <b>–µ—à—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</b> ‚Äî –∏ –∑–¥–æ—Ä–æ–≤—å–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —ç—Ç–∏—Ö —Ä–µ—à–µ–Ω–∏–π
‚Äì –°–µ—Ä–≤–∏—Å <b>—ç–∫–æ–Ω–æ–º–∏—Ç —Ç–≤–æ–µ –≤—Ä–µ–º—è</b> –∏ –±–µ—Ä–µ–∂–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º
‚Äì <b>–¶–µ–Ω–∞ –º–µ–Ω—å—à–µ, —á–µ–º –∑–∞ –∫–æ—Ñ–µ</b>, –∞ –ø–æ–ª—å–∑–∞ ‚Äî –Ω–∞ –≥–æ–¥—ã –≤–ø–µ—Ä—ë–¥
‚Äì –≠—Ç–æ –≤–ª–æ–∂–µ–Ω–∏–µ –≤ <b>—Ç–≤–æ—ë —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ, —è—Å–Ω–æ—Å—Ç—å —É–º–∞ –∏ –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ</b>

---

<b>–°–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–º—É –ø–∏—Ç–∞–Ω–∏—é</b>.
–ù–∞–∂–º–∏ üëâ /buy –∏–ª–∏ –∫–Ω–æ–ø–∫—É ¬´‚úÖ <b>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø</b>¬ª ‚Äî –∏ –Ω–∞—á–Ω–∏ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–µ–±–µ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è!`;

    const keyboard = new InlineKeyboard()
      .text('‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø', CALLBACK_DATA.GO_TO_PAYMENT)
      .row()
      .text('üîô –ù–∞–∑–∞–¥', CALLBACK_DATA.GO_TO_MAIN_MENU);

    if (ctx.callbackQuery) {
      await ctx.answerCallbackQuery();
      await ctx.deleteMessage();
    }

    await ctx.reply(text, {
      parse_mode: 'HTML',
      reply_markup: keyboard,
    });
  }
}
